@{
    ViewData["Title"] = "";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .btn-outline-secondary.rounded-pill.btn-lg {
        color: white;
        border: transparent;
        position: relative;
    }

    .btn-outline-secondary.rounded-pill.btn-lg:hover {
        background-color: rgb(3, 170, 254);
        color: white;
        border: transparent;
    }

    .btn-primary.rounded-pill.btn-lg:hover {
        background-color: rgb(3, 170, 254);
        color: white;
        border: transparent;
    }

    .btn-primary.rounded-pill.btn-lg {
        color: white;
        border: transparent;
        position: relative;
        padding: 8px 20px;
    }

    .bg-gradient {
        background-image: linear-gradient(to bottom, #ffffff, #005eff) !important;
        min-height: 100vh;
        margin-bottom: 10vh;
        position: relative;
    }

    .header-container {
        padding-top: 5vh;
    }

</style>






<div class="container-fluid">
    <div class="row mt-5">
        <div class="col-12 h-100 text-center header-container">
            <header>
                <h1>File Upload Portal</h1>
            </header>
        </div>
    </div>

    <div class="row mt-5 justify-content-center">
        <button class="btn btn-primary rounded-pill btn-lg text-white text-decoration-none"
            type="button" id="upload-button">Browse files</button>
        <span id="selected-file-name"></span>
    </div>

    <br>
    <br>

    <div class="row mt-5 justify-content-center">
        <button class="btn btn-primary rounded-pill btn-lg text-white text-decoration-none" onclick="uploadDocument()"
            type="button" id="browse-button">Next</button>
    </div>
</div>





<script src="/js/fileUpload.js"></script>
<script>
    const uploadButton = document.getElementById('upload-button');
    const selectedFileName = document.getElementById('selected-file-name');

    uploadButton.addEventListener('click', () => {
        const fileInput = document.createElement("input");
        fileInput.type = "file";

        fileInput.addEventListener("change", (event) => {
            const selectedFile = event.target.files[0];
            if (selectedFile) {
                selectedFileName.textContent = "Selected file: " + selectedFile.name;

                // Send the selected file to the API for server-side execution
                const formData = new FormData();
                formData.append('targetFile', selectedFile);
                fetch('/api/fileupload/upload', {
                    method: 'POST',
                    body: formData
                })
                    .then(response => response.json())
                    .then(data => console.log(data))
                    .catch(error => console.error('Upload error:', error));
            }
        });

        fileInput.click(); // Trigger the file selection dialog
    });

    function uploadDocument() {
        const requestBody = {
            Namespace: "Deven",
            FileName: "contract.pdf"
        };
        fetch(window.location.protocol + "//" + window.location.host + "/api/indexer/insertDocument", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestBody)
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log(data);
            })
            .catch(error => {
                console.error('Fetch error:', error);
            });
    }
</script>